<!DOCTYPE HTML>
<html lang="en">
<link rel="stylesheet" href="main.css" type="text/css" />

    <head>
        <title>PictaPhone</title>
        <script src="./javascript/canvas.js" defer></script>
        <script src="./javascript/prompt.js" defer></script>
        <meta name="viewport" content="width=device-width, user-scalable=no, intial-scale=1">
        
    </head>
    
    <body>
        
        <!--Main Page screen-->
        
        <audio id="audio" loop>
            <source src="BorderMusic.mp3" type="audio/mp3">
        </audio>

        <div id="mainPage">
            
            <div align="center">

                <h1>
                    Welcome to PictaPhone
                </h1>
        
            </div>

            
            <div align="center">
    
                <h2>
                    Start a new game?
                </h2>
        
                <button class="new_button" onclick="createButtonClicked()">
                    Make new game!
                </button>
    
            </div>
    
            <div align="center">
    
                <h2>
                    Join an existing game?
                </h2>
    
                <button class="join_button" id="mainJoinButton" onclick="mainJoinButtonClicked()">
                    Join existing game!
                </button>
        
            </div>
    
            <div class="gamedescrip">
            
                <h2 align="center">
                    Description:
                </h2>
    
                <p class="description">
                    Welcome to PictaPhone. PictaPhone is a drawing version of the classic game, Telephone. 
                    The game will consist of multiple rounds that are either prompt rounds or 
                    drawing rounds. In the 
                    initial prompt round, players will have to come up with a prompt. Then the drawing round will commence
                    where players must draw a picture that they 
                    believe best represents the random prompt that they were given. Similarly,
                    the following round 
                    will involve each player getting a random drawn picture they will have to 
                    guess what the initial prompt was. This process repeats until all the rounds
                    have concluded. Then, there will be a time at the end to collectively view the
                    journey that each prompt went through 
    
                </p>
        
            </div>

        </div>

        <!--Transition join screen-->
        <div id="joinPage" style="display:none">
            <div align="center">

                <h1>
                    Join a new game!
                </h1>
        
                
            </div>
            <div align="center">
    
                <h2>
                    Enter game code:
                </h2>
        
                <input type="text" id="lobbyIDInput" size = 20 maxlength="35" value="">
    
    
            </div>
    
            <div align="center">
    
                <h2>
                    Enter your name:
                </h2>
    
                <input type="text" id="usernameInput" size = 20 maxlength="35" value="">
        
            </div>
            <br></br>
        
            <div align="center">
    
                <button class="join_button" id="joinJoinButton" onclick="joinJoinButtonClicked()">
                    Join!
                </button>
            
            </div>
        </div>

        <!--Main Screen Lobby screen-->
        <div id="lobbyPage" style="display:none">
            <!-- <svg class="promptTimer"  viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <g class="promptTimerCircle">
                  <circle  class="promptTimepath" cx="50" cy="50" r="45" />
                </g>
            </svg> -->
            <!-- <div class="timerBox" align="center"> -->
            <div class="timerLabel1" id="timerLabel1" >
            </div>
            
            
            <div align="center">

                <h1>
                    Welcome to the Game Lobby!
                </h1>
        
            </div>
            <div class = "gamecodetext">
    
                <h2>
                    Game Code
                </h2>
            
            </div>
    
            <div class = "gamecodebox">
    
                <div class="boxed" id="lobbyIDDisplay">
                    Insert Game Code Here from Server
                  </div>
    
                
            </div>
    
            <div class = "start_button_location"  onclick="startGameButtonClicked()">
                
                <button class="start_button">
                    Start Game!
                </button>
    
            </div>
                
           
    
            <div class = "waitingtext">
               
                <h2>Waiting Room:</h2>
            
            </div>
            
            
    
            <div class="waitingbox" id="playerList">
                    Names from the server that are already in the game
            </div>
        </div>


        <!--Player Lobby screen-->
        <div id="playerLobbyPage" style="display:none">
            <div align="center">

                <h1>
                    Welcome to the Game Lobby!
                </h1>

                <div class = "playerWaitingText">
                
                    <h2>Waiting Room:</h2>
                
                
                </div>

                <div class="lobbybox" id="playerListPlayer"></div>
            </div>
            
        </div>
    
        <!--Prompt screen with no canvas-->
        <div id="promptPage" style="display:none">
         

            <div align="center">

                <h1>
                    Give us your best prompt!
                </h1>

                <textarea name="text" id="prompt" rows="6"  wrap="soft" maxlength="100" placeholder="Enter Prompt Here"> </textarea>
                <br>
                </br>
                <button class="enter_button" id="submitPrompt" onclick="enterPromptButtonClicked()">Enter</button>
            </div>
            
        </div>

        <!--Prompt screen-->
        <div id="promptPageWithCanvas" style="display:none">
         
            <div align="center">
                <h2>
                    <img id="canvasForPrompt" alt="Text for giving prompt inspiration"
                    width="45%" height="40%">
                    </img>
                </h2>
            </div>

            <div align="center">
                <textarea name="text" id="prompt2" rows="6"  wrap="soft" maxlength="100" placeholder="Enter Prompt Here"> </textarea>
                <br>
                </br>
                <button class="enter_button" id="submitPrompt" onclick="enterPromptButtonClicked2()">Enter</button>
            </div>
            
        </div>


        <!--Waiting for next round screen-->
        <div id="waitingNextRoundPage" style="display:none">
            <!-- <svg class="promptTimer"  viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <g class="promptTimerCircle">
                  <circle class="promptTimepath" cx="50" cy="50" r="45" />
                </g>
            </svg>
            <span class="timerLablel" onload="TimeLeft()" align = "center">
            </span> -->
            

            <div align="center">

                <h1>
                    Waiting for Players to finish
                </h1>
        
                
            </div>
    
            <div align = "center">
    
                <p>
                    Finished Players
                </p>
                <div class="lobbybox" id="finishedPlayers">
                    Names from the server that are already done
                </div>
    
            </div>
            <br>
            </br>
            <div align = "center">

                <p>
                    Unfinished Players
                </p>
                <div class="lobbybox" id="unfinishedPlayers">
                    Names from the server are not done
                </div>
    
            </div>
            
        </div>


        <!--Canvas screen-->
        <div id="canvasPage" style="display:none">
            <div align="center">
                <h1>
                    PictaPhone
                </h1>
            </div>
            <div align="center">
                <h2>
                    Draw the Prompt below!
                </h2>
            </div>

            <div align="center">
                <h2>
                    <div class="text" id="promptToDraw">
                        Prompt
                    </div>
                </h2>
            </div>

          <!--Set up canvas & quick version of setting up fabric-->
            <div align="center">

                <canvas id="canvas" width="400%" height="375%" style="border:1px solid #000000;"></canvas>
                <script src="https://cdn.jsdelivr.net/npm/fabric"></script>
                
                <label for="colorpicker" style="color:white">Change Color:</label>
                <input type="color" id="colorpicker" value="#000000" oninput="changeColor()">
                
                <label for="sizepicker" style="color:white">Change Brush Size:</label>
                <input type="range" id="sizepicker" min="1" max="30" value="5" oninput="changeSize()">
                <output id="sizeValue" style="color:white"></output>

                <button onclick="undo()">Undo</button>
                <button onclick="redo()">Redo</button>
                
                <script src="javascript/canvas.js"></script>

            </div>  
                    

            <div align="center">
                <button class="enter_button" id="submitCanvas" onclick="enterCanvasButtonClicked()">I'm done drawing!</button>
            </div>
        </div>

        
        <!--Main canvas page-->
        <div id="mainCanvasPage" style="display:none">
            <div align="center">

                <h1>
                    Do you draw like Picasso or a 4-year old???
                </h1>
        
                
            </div>
    
           
    
            <div align = "center">
    
                <h2>
    
                    Time Remaining: 
    
                    
    
                </h2> 
                <div class="timerLabel3" id="timerLabel3" >
                    
                </div>
    
                
            </div>
            <br>
            </br>
            <div align = "center">
    
                <div class="lobbybox" id="mainCanvasFinishedPlayers">
                    Cool People with beautiful drawings:
                </div>
    
            </div>
            <br>
            </br>
            <div align = "center">
    
                <div class="lobbybox" id="mainCanvasUnfinishedPlayers">
                    People who draw slow:
                </div>
    
            </div> 
        </div>

              
        <!--Main prompt page-->
        <div id="mainPromptPage" style="display:none">
            
            <div align="center">

                <h1>
                    Who is going to come up with the best prompt???
                </h1>
                
            </div>
    
            <div align = "center">
    
                <h2>
    
                    Time Remaining: 
    
                </h2> 
                <div class="timerLabel2" id="timerLabel2" >
                    
                </div>
       
            </div>
            <br>
            </br>
            <div align = "center">
    
                <div class="lobbybox" id="mainPromptFinishedPlayers">
                    Cool People with great prompts:<br>
                </div>
    
            </div>
            <br>
            </br>
            <div align = "center">
    
                <div class="lobbybox" id="mainPromptUnfinishedPlayers">
                    People who don't know what a prompt is:<br>
                </div>
    
            </div>
        </div>


        <!--End Game Choose Book-->
        <div id="endGameChoose" style="display:none">
            <div align="center">

                <h1>
                    Congratulations! Here are the results
                </h1>
                
                <h2>
                    Click on a book to view the contents
                </h2>
        
            </div>
           
            <table align="center">
                <tr>
                    <td class="bookButton" style="visibility:visible;"><button class="box" id="book1Box" onclick="book1Clicked()"></button></td>
                    <td class="bookButton" style="visibility:visible;"><button class="box" id="book2Box" onclick="book2Clicked()"></button></td>
                    <td class="bookButton" id="book3" style="visibility:hidden;"><button class="box" id="book3Box" onclick="book3Clicked()"></button></td>
                </tr>
                <tr>
                    <td class="bookButton" id="book4" style="visibility:hidden;"><button class="box" id="book4Box" onclick="book4Clicked()"></button></td>
                    <td class="bookButton" id="book5" style="visibility:hidden;"><button class="box" id="book5Box" onclick="book5Clicked()"></button></td>
                    <td class="bookButton" id="book6" style="visibility:hidden;"><button class="box" id="book6Box" onclick="book6Clicked()"></button></td>
                </tr>
                <tr>
                    <td class="bookButton" id="book7" style="visibility:hidden;"><button class="box" id="book7Box" onclick="book7Clicked()"></button></td>
                    <td class="bookButton" id="book7" style="visibility:hidden;"><button class="box" id="book8Box" onclick="book8Clicked()"></button></td>
                    <td class="bookButton" id="book9" style="visibility:hidden;"><button class="box" id="book9Box" onclick="book9Clicked()"></button></td>
                </tr>
            </table>

            <div align="center">
            <button class="new_button" onClick="window.location.reload()">
                Return to homescreen
            </button>
            </div>
              
        </div>


         <!--End Game canvas results-->
        <div id="endGameCanvasResults" style="display:none">
            <div align="center">

                <h1>
                    <div class="text" id="playerBookCanvas"></div>
                </h1>

                
        
            </div>
           
            <div class="container">
                <button class="arrow-button left" id="canvasLeftArrow" onclick="setTimeout(canvasLeftArrowClicked, 500)">&lt;</button>
                <img id="endGameCanvas"
                    width="70%" height="70%">
                </img>
                <button class="arrow-button right" id="canvasRightArrow" onclick="setTimeout(canvasRightArrowClicked, 500)">&gt;</button>
              </div>
              
              <div class="drawn">
                <h1>
                    <div class="text" id="drawnBy"></div>
                </h1>
            </div>
        </div>


        <!--End Game prompt results-->
        <div id="endGamePromptResults" style="display:none">
            <div align="center">
                <h1>
                    <div class="text" id="playerBookPrompt"></div>
                </h1>
            </div>
            <div class="container">
                <button class="arrow-button left" id="promptLeftArrow" onclick="setTimeout(promptLeftArrowClicked, 500)">&lt;</button>
                <div align="center">
                    <h2>
                        <div class="resultPrompt" id="resultsPrompt">
                            Prompt
                        </div>
                    </h2>
                </div>
                <button class="arrow-button right" id="promptRightArrow" onclick="setTimeout(promptRightArrowClicked, 500)">&gt;</button>
            </div>
            <div class="written">
                <h1>
                    <div class="text" id="writtenBy"></div>
                </h1>
            </div>
        </div>


         <!--End Game PLAYER PAGE-->
        <div id="playerEndGameResults" style="display:none">   
            <div align="center">

                <h1>
                    Thank you for playing the game!
                </h1>
                
                <h2>
                    Pay attention to the main screen to see the results!
                </h2>

                <button class="new_button" onClick="window.location.reload()">
                    Return to homescreen
                </button>
            </div>
        </div>


        <script src="/socket.io/socket.io.js"></script>

        <script>
            const socket = io();
            //var startTimer;
            
            /* HTML elements */


            
            const screenViews = {
              mainPage: document.getElementById("mainPage"),
              joinPage: document.getElementById("joinPage"),
              lobbyPage: document.getElementById("lobbyPage"),
              playerLobbyPage: document.getElementById("playerLobbyPage"),
              promptPage: document.getElementById("promptPage"),
              promptPageWithCanvas: document.getElementById("promptPageWithCanvas"),
              waitingNextRoundPage: document.getElementById("waitingNextRoundPage"),
              canvasPage: document.getElementById("canvasPage"),
              mainCanvasPage: document.getElementById("mainCanvasPage"),
              mainPromptPage: document.getElementById("mainPromptPage"),
              endGameChoose: document.getElementById("endGameChoose"),
              endGamePromptResults: document.getElementById("endGamePromptResults"),
              endGameCanvasResults: document.getElementById("endGameCanvasResults"),
              playerEndGameResults: document.getElementById("playerEndGameResults")
            };

            const bookViews = {
              book3: document.getElementById("book3"),
              book4: document.getElementById("book4"),
              book5: document.getElementById("book5"),
              book6: document.getElementById("book6"),
              book7: document.getElementById("book7"),
              book8: document.getElementById("book8"),
              book9: document.getElementById("book9")
            };

            const lobbyIDInput = document.getElementById("lobbyIDInput");
            const usernameInput = document.getElementById("usernameInput");
            const lobbyIDDisplay = document.getElementById("lobbyIDDisplay");

            const playerList = document.getElementById("playerList");
            const playerListPlayer = document.getElementById("playerListPlayer");
            const finishedPlayers = document.getElementById("finishedPlayers");
            const unfinishedPlayers = document.getElementById("unfinishedPlayers");

            const mainPromptFinishedPlayers = document.getElementById("mainPromptFinishedPlayers");
            const mainPromptUnfinishedPlayers = document.getElementById("mainPromptUnfinishedPlayers");
            const mainCanvasFinishedPlayers = document.getElementById("mainCanvasFinishedPlayers");
            const mainCanvasUnfinishedPlayers = document.getElementById("mainCanvasUnfinishedPlayers");

            const promptValue = document.getElementById("prompt").value;
            const promptToDraw = document.getElementById("promptToDraw");
            const canvasDrawing = document.getElementById('canvas');
            const canvasForPrompt = document.getElementById('canvasForPrompt');
            const colorPicker = document.getElementById("colorpicker").value;
            const sizePicker = document.getElementById("sizepicker").value;

            const endGameCanvas = document.getElementById('endGameCanvas');
            const resultsPrompt = document.getElementById("resultsPrompt");
            const promptRightArrow = document.getElementById("promptRightArrow");
            const canvasRightArrow = document.getElementById("canvasRightArrow");
            const promptLeftArrow = document.getElementById("promptLeftArrow");
            const canvasLeftArrow = document.getElementById("canvasLeftArrow");
            
            
            /* Utility Functions */
            
            function switchView(newViewName){
              for (let [viewName, view] of Object.entries(screenViews)) {
                if (viewName === newViewName) {
                  view.style.display = 'block';
                } 
                else {
                  view.style.display = 'none';
                }
              }
            }
            
            /* Game Functionality */
            
            /* Create a new game. Emit newGame event. */
            function createButtonClicked() {
                var audio = document.getElementById("audio");
                audio.play();
                socket.emit('createClicked', socket.id);
            }
            
            
            
            /* The join button was clicked on the initial main screen */
            function mainJoinButtonClicked() {
                switchView("joinPage");
            }

            /* The join button was clicked after entering the game code and name of player */
            function joinJoinButtonClicked() {
                const lobbyIDInput = document.getElementById("lobbyIDInput");
                const usernameInput = document.getElementById("usernameInput");
                
                socket.emit("joinClicked", usernameInput.value, lobbyIDInput.value);
            }

            // The start game button was clicked
            function startGameButtonClicked() {

                const lobbyIDInput = document.getElementById("lobbyIDInput");
                socket.emit("startGameClicked", socket.id);
            }

            // The enter prompt button was clicked
            function enterPromptButtonClicked() {
                const lobbyIDInput = document.getElementById("lobbyIDInput");
                const usernameInput = document.getElementById("usernameInput");
                const promptValue = document.getElementById("prompt").value;
                socket.emit("promptEntered", usernameInput.value, lobbyIDInput.value, promptValue);
            }

            // The enter prompt button was clicked
            function enterPromptButtonClicked2() {
                const lobbyIDInput = document.getElementById("lobbyIDInput");
                const usernameInput = document.getElementById("usernameInput");
                const promptValue2 = document.getElementById("prompt2").value;
                console.log(promptValue2);
                socket.emit("promptEntered", usernameInput.value, lobbyIDInput.value, promptValue2);
            }

            // The enter canvas button was clicked
            function enterCanvasButtonClicked() {
                const lobbyIDInput = document.getElementById("lobbyIDInput");
                const usernameInput = document.getElementById("usernameInput");
                const canvasDrawing = document.getElementById('canvas');
                const savedCanvas = canvasDrawing.toDataURL('png');
                socket.emit("canvasEntered", usernameInput.value, lobbyIDInput.value, savedCanvas);
            }
            

            /* End Game Book Buttons */

            function book1Clicked(){
                socket.emit("bookClicked", 1, socket.id);
                if (!document.getElementById("book1Box").innerHTML.includes("seen")) {
                    document.getElementById("book1Box").innerHTML += "<br/>(seen)"
                }
            }

            function book2Clicked(){
                socket.emit("bookClicked", 2, socket.id);
                if (!document.getElementById("book2Box").innerHTML.includes("seen")) {
                    document.getElementById("book2Box").innerHTML += "<br/>(seen)"
                }
            }

            function book3Clicked(){
                socket.emit("bookClicked", 3, socket.id);
                if (!document.getElementById("book3Box").innerHTML.includes("seen")) {
                    document.getElementById("book3Box").innerHTML += "<br/>(seen)"
                }
            }

            function book4Clicked(){
                socket.emit("bookClicked", 4, socket.id);
                if (!document.getElementById("book4Box").innerHTML.includes("seen")) {
                    document.getElementById("book4Box").innerHTML += "<br/>(seen)"
                }
            }

            function book5Clicked(){
                socket.emit("bookClicked", 5, socket.id);
                if (!document.getElementById("book5Box").innerHTML.includes("seen")) {
                    document.getElementById("book5Box").innerHTML += "<br/>(seen)"
                }
            }

            function book6Clicked(){
                socket.emit("bookClicked", 6, socket.id);
                if (!document.getElementById("book6Box").innerHTML.includes("seen")) {
                    document.getElementById("book6Box").innerHTML += "<br/>(seen)"
                }
            }

            function book7Clicked(){
                socket.emit("bookClicked", 7, socket.id);
                if (!document.getElementById("book7Box").innerHTML.includes("seen")) {
                    document.getElementById("book7Box").innerHTML += "<br/>(seen)"
                }
            }

            function book8Clicked(){
                socket.emit("bookClicked", 8, socket.id);
                if (!document.getElementById("book8Box").innerHTML.includes("seen")) {
                    document.getElementById("book8Box").innerHTML += "<br/>(seen)"
                }
            }

            function book9Clicked(){
                socket.emit("bookClicked", 9, socket.id);
                if (!document.getElementById("book9Box").innerHTML.includes("seen")) {
                    document.getElementById("book9Box").innerHTML += "<br/>(seen)"
                }
            }

            /* Results Page Navigation */

            function promptRightArrowClicked() {
                socket.emit("promptRightArrowClicked", socket.id);
            }

            function canvasRightArrowClicked() {
                socket.emit("canvasRightArrowClicked", socket.id);
            }

            function promptLeftArrowClicked() {
                socket.emit("promptLeftArrowClicked", socket.id);
            }

            function canvasLeftArrowClicked() {
                socket.emit("canvasLeftArrowClicked", socket.id);
            }


            /* Socket Functionality */

            socket.on("enterPrompt", function() {
                const promptValue = document.getElementById("prompt").value;
                if(promptValue != ""){
                    console.log("entering enterPromptButtonClicked()");
                    enterPromptButtonClicked();
                }
                else{
                    console.log("entering enterPromptButton2Clicked()");
                    enterPromptButtonClicked2();
                }
            });


            socket.on("enterCanvas", function() {
                enterCanvasButtonClicked();
            });


            socket.on("roomCreated", function(lobbyID) {
                switchView("lobbyPage");

                lobbyIDDisplay.innerHTML = lobbyID;
            });


            socket.on("addPlayerToWaitingList", function(players) {
                playerUsernames = players.map((player) => player.username);
                playerList.innerHTML = playerUsernames.join('<br>');
                playerListPlayer.innerHTML = playerUsernames.join('<br>');
            });


            socket.on("playerToWaitingRoom", function() {
                switchView("playerLobbyPage"); //Will be a different page
            });


            socket.on("addPlayerToFinishedList", function(finishedUsernames, allUsernames){
                finishedPlayers.innerHTML = finishedUsernames.join('<br>'); //Might want to change this to appending a child, otherwise it will replace
                unfinishedUsernames = allUsernames.filter(
                function(i) {
                    return this.indexOf(i) < 0;
                },
                finishedUsernames
                );
                unfinishedPlayers.innerHTML = unfinishedUsernames.join('<br>');
            });


            socket.on("mainPromptFinishedList", function(finishedUsernames, allUsernames){
                mainPromptFinishedPlayers.innerHTML = "Cool People with great prompts:<br>" + finishedUsernames.join('<br>');
                unfinishedUsernames = allUsernames.filter(
                function(i) {
                    return this.indexOf(i) < 0;
                },
                finishedUsernames
                );
                mainPromptUnfinishedPlayers.innerHTML = "People who don't know what a prompt is:<br>" + unfinishedUsernames.join('<br>');
            });


            socket.on("mainCanvasFinishedList", function(finishedUsernames, allUsernames){
                mainCanvasFinishedPlayers.innerHTML = "Cool People with beautiful drawings:<br>" + finishedUsernames.join('<br>');
                unfinishedUsernames = allUsernames.filter(
                function(i) {
                    return this.indexOf(i) < 0;
                },
                finishedUsernames
                );
                mainCanvasUnfinishedPlayers.innerHTML = "People who draw slow:<br>" + unfinishedUsernames.join('<br>');
            });


            socket.on("playerToPrompt", function() {
                document.getElementById("prompt").value = "";
                switchView("promptPage");
            });


            socket.on("playerToPromptWithCanvas", function() {
                document.getElementById("prompt").value = "";
                switchView("promptPageWithCanvas");
            });


            socket.on("mainToPrompt", function() {
                mainPromptFinishedPlayers.innerHTML = "Cool People with great prompts:<br>";
                mainPromptUnfinishedPlayers.innerHTML = "People who don't know what a prompt is:<br>";
                switchView("mainPromptPage");
            });

            socket.on("displayPrompt", function(game) {
                for(let j = 0; j < game.numPlayers; j++){
                    if (game.players[j].socketID == socket.id){
                        promptToDraw.innerHTML = game.players[j].currentBook.pages[game.currRound-1].stringInput;
                        break;
                    }
                }
            });

            socket.on("displayCanvas", function(game) {
                for(let j = 0; j < game.numPlayers; j++){
                    if (game.players[j].socketID == socket.id){
                        canvasForPrompt.src = game.players[j].currentBook.pages[game.currRound-1].stringInput;
                        break;
                    }
                }
            });

            socket.on("playerToWaitingNextRound", function() {
                switchView("waitingNextRoundPage");
            });

            socket.on("playerToCanvas", function() {
                // startTimer = true;
                clearCanvas();
                document.getElementById("colorpicker").value="#000000";
                document.getElementById("sizepicker").value="5";
                switchView("canvasPage");
            });

            socket.on("mainToCanvas", function() {
                mainCanvasFinishedPlayers.innerHTML = "Cool People with beautiful drawings:<br>";
                mainCanvasUnfinishedPlayers.innerHTML = "People who draw slow:<br>";
                switchView("mainCanvasPage");
            });

            socket.on("playersToEndgame", function() {
                switchView("playerEndGameResults");
            });

            /* Switches the main screen to where it chooses the book to view the results of. */
            socket.on("mainToEndgame", function() {
                switchView("endGameChoose");
            });

            /* Makes visible the books based on the number of players, and
                puts the player name on the books (Only allow to do once) */
                socket.on("putNamesOnBooks", function(game) {
                document.getElementById("book1Box").innerHTML = game.players[0].username;
                document.getElementById("book2Box").innerHTML = game.players[1].username;
                if (3 <= game.numPlayers) {
                    document.getElementById("book3").style.visibility = 'visible';
                    document.getElementById("book3Box").innerHTML = game.players[2].username;
                    if (4 <= game.numPlayers) {
                        document.getElementById("book4").style.visibility = 'visible';
                        document.getElementById("book4Box").innerHTML = game.players[3].username;
                        if (5 <= game.numPlayers) {
                            document.getElementById("book5").style.visibility = 'visible';
                            document.getElementById("book5Box").innerHTML = game.players[4].username;
                            if (6 <= game.numPlayers) {
                                document.getElementById("book6").style.visibility = 'visible';
                                document.getElementById("book6Box").innerHTML = game.players[5].username;
                                if (7 <= game.numPlayers) {
                                    document.getElementById("book7").style.visibility = 'visible';
                                    document.getElementById("book7Box").innerHTML = game.players[6].username;
                                    if (8 <= game.numPlayers) {
                                        document.getElementById("book8").style.visibility = 'visible';
                                        document.getElementById("book8Box").innerHTML = game.players[7].username;
                                        if (9 <= game.numPlayers) {
                                            document.getElementById("book9").style.visibility = 'visible';
                                            document.getElementById("book9Box").innerHTML = game.players[8].username;
                                        }}}}}}}
            });

                                        
            //how do we want to call this?
            socket.on("displayEndGameCanvas", function(game, player, whoInputted) {
                switchView("endGameCanvasResults");
                document.getElementById("playerBookCanvas").innerHTML = player.username + '\'s Book';
                document.getElementById("drawnBy").innerHTML = "Drawn by " + whoInputted;
                endGameCanvas.src = player.startBook.pages[game.host.currResultPage].stringInput;
            });

            socket.on("displayEndGamePrompt", function(player, prompt, whoInputted) {
                switchView("endGamePromptResults");
                document.getElementById("playerBookPrompt").innerHTML = player.username + '\'s Book';
                document.getElementById("writtenBy").innerHTML = "Written by " + whoInputted;
                resultsPrompt.innerHTML = prompt;
            });

            function isPageDisplaying(page)
            {
                let newViewName;
                if(page === "canvas"){
                    newViewName = "mainPromptPage";
                }else if (page === "prompt"){
                    newViewName = "mainCanvasPage";
                }else{
                    newViewName = "mainPromptPage"
                }
                for (let [viewName, view] of Object.entries(screenViews)) {
                    if (viewName === newViewName) {
                        if(view.style.display === 'none'){
                            return false;
                        }else{
                            return true;
                        }
                    } 
                    
                }
                return true;
            }

            function allPlayersSubmit(lobbyID, games, page){
                for(let j = 0; j < games.numPlayers; j++){
                    if (!(games.finishedPlayers.includes(games.players[j].socketID))){
                        if(page == 'prompt'){
                            socket.emit("promptEntered", games.players[j].username, lobbyID, null);
                        }else{
                            socket.emit("canvasEntered", games.players[j].username, lobbyID, null);
                        }
                    }
                }
            }

            socket.on("timerStart", function(game, page, start, lobbyID) {
                //console.log("here");
                //var startDate = new Date();
                var startDate = new Date(start);
                document.getElementById("timerLabel2").innerHTML = 0 + "m " + 45 + "s ";

                //startDate.setMinutes(startDate.getMinutes() + 1);
                startDate.setSeconds(startDate.getSeconds() + 46);
                //startDate.setSeconds(startDate.getSeconds() + 11);

                
                if (page == 'prompt'){
                    startDate.setMinutes(startDate.getMinutes() + 1);
                    //startDate.setSeconds(startDate.getSeconds() + 20);
                }
                var x = setInterval(function() {
                    if (game.timerStatus == true){
                        // today's date and time
                        var nowDate = new Date().getTime();
                        // timeleft
                        var timeLeft = startDate - nowDate;
                        
                        // var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        // var hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        var minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                        // display the results
                        page = page.trim();

                        if(page == 'start'){
                            document.getElementById("timerLabel2").innerHTML = minutes + "m " + seconds + "s ";
                        } else if(page == 'prompt'){
                            
                            document.getElementById("timerLabel3").innerHTML = minutes + "m " + seconds + "s ";
                        } else if (page == 'canvas'){
                            document.getElementById("timerLabel2").innerHTML = minutes + "m " + seconds + "s ";
                        }

                        if(!isPageDisplaying(page)){
                            timeLeft = -5;
                            
                        }
                        //document.getElementById("timerLabel1").innerHTML = minutes + "m " + seconds + "s ";
                        //document.getElementById("timerLabel2").innerHTML = minutes + "m " + seconds + "s ";
                        //document.getElementById("timerLabel3").innerHTML = minutes + "m " + seconds + "s ";
                        //All entries are subimited when time =0
                        
                        if (timeLeft < 0) {
                            clearInterval(x);
                            //startDate = new Date();
                            //startDate.setMinutes(startDate.getMinutes() + 1);
                            document.getElementById("timerLabel1").innerHTML = "EXPIRED";
                            document.getElementById("timerLabel2").innerHTML = "EXPIRED";
                            document.getElementById("timerLabel3").innerHTML = "EXPIRED";
                            //figure out how to find what pages are displaying
                            //figure out how to subimt all responses forcefully
                            const lobbyIDDisplay = document.getElementById("lobbyIDDisplay").innerHTML;
                            page = page.trim();
                            if(timeLeft != -5){
                                if (page == 'canvas' || page == 'start'){
                                    //document.getElementById('submitPrompt').click();
                                    socket.emit("timerFinishedPrompt", lobbyIDDisplay);
                                }
                                if (page == 'prompt'){
                                    //document.getElementById('submitCanvas').click();
                                    socket.emit("timerFinishedCanvas", lobbyIDDisplay);
                                }
                            }   

                        }
                   // } else{
                        //console.log('here');
                        //clearInterval(x);
                        /*const lobbyID = document.getElementById("lobbyIDDisplay").innerHTML;
                        page = page.trim();
                        if (page == 'prompt'){
                            //document.getElementById('submitPrompt').click();
                            socket.emit("timerFinishedPrompt", lobbyID);
                            //enterPromptButtonClicked();
                        }
                        if (page == 'canvas'){
                            //document.getElementById('submitCanvas').click();
                            socket.emit("timerFinishedCanvas", lobbyID);
                            //enterCanvasButtonClicked();
                        } */
                        //startDate = new Date();
                        //startDate.setMinutes(startDate.getMinutes() + 1);
                        //document.getElementById("timerLabel1").innerHTML = 1 + "m " + 0 + "s ";
                        //document.getElementById("timerLabel2").innerHTML = 1 + "m " + 0 + "s ";
                        //document.getElementById("timerLabel3").innerHTML = 1 + "m " + 0 + "s ";
                    }
                }, 1000);
            });
            

        </script>
    </body>
</html>
